---
title: "Notebook to test rules"
author: "Dheekshitha PS"
date: "15 June 2018"
output:
  html_document:

    code_folding: show
    toc: yes
    toc_depth: 5
  html_notebook:
    toc: yes
    toc_depth: 5
  pdf_document:
    toc: yes
    toc_depth: '5'
---

```{r echo = FALSE, message = FALSE, results = 'hide', warning = FALSE, error=FALSE}
#Package installation if required for handbook
required.packages <- c('Rdrools','DT','lubridate','purrr','dplyr')

for(pkg in required.packages){
  if(!require(pkg,character.only = T)){
    install.packages(pkg, repos = "http://cloud.r-project.org/")
    library(pkg)
  }
}

```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#Sourcing the required R scripts
source(file = "./src/main/resources/Rdrools/R/Rdrools.R")


```
## Loading the sample data
```{r}


testdata <- iris
colnames(testdata) <- gsub('\\.', '', colnames(testdata))
str(testdata)
```

     
```{r,echo=FALSE}

datatable(
  head(testdata, 20), extensions = 'FixedColumns',
  options = list(
  dom = 't',
  scrollX = TRUE,
  scrollCollapse = TRUE
))
```



## Loading the sample rules


Each rule in the below is csv is:
  * Rule1: Only filter,no aggregation
  * Rule2: No filter and groupby 
  * Rule3: No Filter and aggregation on whole column
  * Rule4: Filter and aggregation on whole column
  * Rule5: Filter and groupby
```{r}
testRules <-read.csv("./src/main/resources/Rdrools/data/SampleRules/irisRules.csv",stringsAsFactors = FALSE)
testRules[is.na(testRules)]    <-""
```
  
```{r,echo=FALSE}

datatable(
  head(testRules, 20), extensions = 'FixedColumns',
  options = list(
  dom = 't',
  scrollX = TRUE,
  scrollCollapse = TRUE
))
```



## Running the rules
The function, *executeRulesOnDataset* returns two objects: 
  
  * *perRule*: the list containing the each rule in csv format
 
  * *outputPerRule*: row numbers with flags for each rule
```{r}
output<- executeRulesOnDataset(dataset=testdata,rules = testRules)

```
```{r}

datatable(
  output[["outputPerRule"]][[3]], extensions = 'FixedColumns',
  options = list(
  dom = 't',
  scrollX = TRUE,
  scrollCollapse = TRUE
))
```



-----


## Rule in csv format
```{r,message=NA}

output[["perRule"]][[2]]
```
## Final Output
This function returns the meta data for each rule. The rules involving, groupby will get the group name and flag for each group. The rules with no groupby get the output with all the rows with flags.
```{r}
datatable(
output[["outputPerRule"]][[1]], extensions = 'FixedColumns',
  options = list(
  dom = 't',
  scrollX = TRUE,
  scrollCollapse = TRUE
))


```

Below is how the output looks when there is a groupby
```{r,message=NA}
datatable(
  output[["outputPerRule"]][[5]], extensions = 'FixedColumns',
  options = list(
  dom = 't',
  scrollX = TRUE,
  scrollCollapse = TRUE
))


```

Below is the output when there is aggregation on whole column
```{r}
datatable(
output[["outputPerRule"]][[3]], extensions = 'FixedColumns',
  options = list(
  dom = 't',
  scrollX = TRUE,
  scrollCollapse = TRUE
))


```
